<img src="https://hackernoon.com/drafts/2lfl3taj.png">                    <div class="paragraph"><strong>TL;DR</strong></div><div class="paragraph">Using your testing framework in everyday routine can drastically decrease amount of repeated actions you perform during debugging, investigation or just playing with your code</div><div class="paragraph"><strong>DRY</strong></div><div class="paragraph">You know that principle? DRY - <strong>don&apos;t repeat yourself</strong>. It can be applicable not only for code. Over the years, working side by side with many others developers, i noticed that in most cases we all fail to follow this principle.</div><div class="paragraph">Imagine developing process of some simple API, when initial simple code is already written and you want to test it. The natural intent is to open your favorite browser with autogenerated swagger documentation or postman or any other tool and send request to API. </div><div class="paragraph">Sometimes you want to put a breakpoint somewhere in the code to explore some third party library behaviour with help of debugger or examine some unclear points. Something similar you will do, when you need to find and fix some bug. </div><div class="paragraph">You simply send a request to a broken API, and then investigate the problem with the help of debugger.</div><div class="paragraph">That is the simplest approach and it works perfectly fine, so why would i complain about it? Well, the main reason is the amount of time and manual work needed to start the debugging process. Time to reproduce bug or test some behaviour can be very different and reach a few minutes in some complex cases. </div><div class="paragraph">When a project is large, complex or involves many people, it becomes even more relevant because makes you  take the same steps again and again.</div><div class="paragraph"><strong>AUTOMATE EVERYTHING</strong></div><div class="paragraph">That&apos;s when tests come to the rescue. Let`s look at a small, simple and naive example.</div><div class="paragraph">Here&apos;s a small web API to receive a shopping list and calculate a total price for a product in a cart. I took Flask and pytest to keep the example small, but the idea is relevant to the development process in general.</div><div class="paragraph"><pre><code>app.py</code></pre></div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code><span style="color:#c397d8">import</span> json<span style="color:#c397d8">from</span> flask <span style="color:#c397d8">import</span> Flask, Blueprint, request<span style="color:#c397d8">from</span> flask_restplus <span style="color:#c397d8">import</span> Resource, fields, Apiapi = Api(version=<span style="color:#b9ca4a">&apos;1.0&apos;</span>, title=<span style="color:#b9ca4a">&apos;Test API&apos;</span>, doc=<span style="color:#b9ca4a">&apos;/doc&apos;</span>)namespace = api.namespace(<span style="color:#b9ca4a">&apos;carts&apos;</span>)<span class="hljs-function"><span style="color:#c397d8">def</span> <span style="color:#7aa6da">calculate</span><span style="color:#e78c45">(products)</span>:</span>    result = {        <span style="color:#b9ca4a">&apos;products&apos;</span>: list(products),    }    <span style="color:#c397d8">for</span> product <span style="color:#c397d8">in</span> result[<span style="color:#b9ca4a">&apos;products&apos;</span>]:        product[<span style="color:#b9ca4a">&apos;total&apos;</span>] = product[<span style="color:#b9ca4a">&apos;quantity&apos;</span>] * product[<span style="color:#b9ca4a">&apos;price&apos;</span>]    result[<span style="color:#b9ca4a">&apos;total&apos;</span>] = sum(product[<span style="color:#b9ca4a">&apos;total&apos;</span>] <span style="color:#c397d8">for</span> product <span style="color:#c397d8">in</span> products)    result[<span style="color:#b9ca4a">&apos;average&apos;</span>] = result[<span style="color:#b9ca4a">&apos;total&apos;</span>] / sum(product[<span style="color:#b9ca4a">&apos;quantity&apos;</span>] <span style="color:#c397d8">for</span> product <span style="color:#c397d8">in</span> products)    <span style="color:#c397d8">return</span> result<span style="color:#969896"># serializers</span>Product = api.model(<span style="color:#b9ca4a">&apos;Product&apos;</span>, {    <span style="color:#b9ca4a">&apos;product&apos;</span>: fields.String(required=<span style="color:#c397d8">True</span>),    <span style="color:#b9ca4a">&apos;price&apos;</span>: fields.Float(required=<span style="color:#c397d8">True</span>),    <span style="color:#b9ca4a">&apos;quantity&apos;</span>: fields.Integer(required=<span style="color:#c397d8">True</span>),})Cart = api.model(<span style="color:#b9ca4a">&apos;Cart&apos;</span>, {    <span style="color:#b9ca4a">&apos;products&apos;</span>: fields.List(fields.Nested(Product)),})<span style="color:#e78c45">@namespace.route(&apos;/cart/&apos;)</span><span class="hljs-class"><span style="color:#c397d8">class</span> <span style="color:#7aa6da">CartResource</span><span style="color:#e78c45">(Resource)</span>:</span><span style="color:#e78c45">    @api.expect(Cart, validate=True)</span>    <span class="hljs-function"><span style="color:#c397d8">def</span> <span style="color:#7aa6da">post</span><span style="color:#e78c45">(self)</span>:</span>        cart = json.loads(request.data)        processed_cart = calculate(cart[<span style="color:#b9ca4a">&apos;products&apos;</span>])        <span style="color:#c397d8">return</span> processed_cart<span class="hljs-function"><span style="color:#c397d8">def</span> <span style="color:#7aa6da">create_app</span><span style="color:#e78c45">()</span>:</span>    flask_app = Flask(__name__)    blueprint = Blueprint(<span style="color:#b9ca4a">&apos;api&apos;</span>, __name__, url_prefix=<span style="color:#b9ca4a">&apos;/api/v1&apos;</span>)    api.init_app(blueprint)    api.add_namespace(namespace)    flask_app.register_blueprint(blueprint)    <span style="color:#c397d8">return</span> flask_appapp = create_app()<span style="color:#c397d8">if</span> __name__ == <span style="color:#b9ca4a">&apos;__main__&apos;</span>:    app.run(host=<span style="color:#b9ca4a">&apos;0.0.0.0&apos;</span>)</code></pre></div><div class="paragraph"><pre><code>test_cart.py</code></pre></div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code><span style="color:#c397d8">import</span> pytest<span style="color:#c397d8">from</span> .app <span style="color:#c397d8">import</span> app<span style="color:#e78c45">@pytest.fixture</span><span class="hljs-function"><span style="color:#c397d8">def</span> <span style="color:#7aa6da">client</span><span style="color:#e78c45">()</span>:</span>    app.config[<span style="color:#b9ca4a">&apos;TESTING&apos;</span>] = <span style="color:#c397d8">True</span>    client = app.test_client()    <span style="color:#c397d8">yield</span> client<span class="hljs-function"><span style="color:#c397d8">def</span> <span style="color:#7aa6da">test_valid_cart</span><span style="color:#e78c45">(client)</span>:</span>    data = {        <span style="color:#b9ca4a">&apos;products&apos;</span>: [            {                <span style="color:#b9ca4a">&apos;product&apos;</span>: <span style="color:#b9ca4a">&apos;milk&apos;</span>,                <span style="color:#b9ca4a">&apos;price&apos;</span>: <span style="color:#e78c45">10</span>,                <span style="color:#b9ca4a">&apos;quantity&apos;</span>: <span style="color:#e78c45">1</span>            },            {                <span style="color:#b9ca4a">&apos;product&apos;</span>: <span style="color:#b9ca4a">&apos;bread&apos;</span>,                <span style="color:#b9ca4a">&apos;price&apos;</span>: <span style="color:#e78c45">6</span>,                <span style="color:#b9ca4a">&apos;quantity&apos;</span>: <span style="color:#e78c45">2</span>            }        ]    }    res = client.post(<span style="color:#b9ca4a">&apos;/api/v1/carts/cart/&apos;</span>, json=data)    <span style="color:#c397d8">assert</span> res.status_code == <span style="color:#e78c45">200</span>    <span style="color:#c397d8">assert</span> res.json[<span style="color:#b9ca4a">&apos;total&apos;</span>] == <span style="color:#e78c45">22</span></code></pre></div><div class="paragraph">Command to run application <pre><code>python app.py</code></pre>, to run tests - <pre><code>pytest</code></pre></div><div class="paragraph">The application will work only with correct input data, if i&apos;ll send empty list of products, i&apos;ll get <pre><code>500 error</code></pre></div><div class="paragraph"><em>Here&apos;s when i use curl first time.</em></div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code>curl -X POST \  http://localhost:5000/api/v1/carts/cart/ \  -H <span style="color:#b9ca4a">&apos;Content-Type: application/json&apos;</span> \  -d <span style="color:#b9ca4a">&apos;{  &quot;products&quot;: [  ]}&apos;</span></code></pre></div><div class="paragraph">I&apos;m not gonna provide full traceback, only valuable part. Last lines from traceback below.</div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code>  <span style="color:#969896">#.......</span>  File <span style="color:#b9ca4a">&quot;/app/app.py&quot;</span>, line 43, <span style="color:#c397d8">in</span> post    processed_cart = calculate(cart[<span style="color:#b9ca4a">&apos;products&apos;</span>])  File <span style="color:#b9ca4a">&quot;/app/app.py&quot;</span>, line 20, <span style="color:#c397d8">in</span> calculate    result[<span style="color:#b9ca4a">&apos;average&apos;</span>] = result[<span style="color:#b9ca4a">&apos;total&apos;</span>] / sum(product[<span style="color:#b9ca4a">&apos;quantity&apos;</span>] <span style="color:#c397d8">for</span> product <span style="color:#c397d8">in</span> products)ZeroDivisionError: division by zero</code></pre></div><div class="paragraph">To fix this we can add validation for input data, let&apos;s start from changing <pre><code>Cart</code></pre> API model, adding <pre><code>min_items=1</code></pre> to <pre><code>products</code></pre></div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code><span style="color:#969896"># app.py </span>Cart = api.model(<span style="color:#b9ca4a">&apos;Cart&apos;</span>, {    <span style="color:#b9ca4a">&apos;products&apos;</span>: fields.List(fields.Nested(Product), min_items=<span style="color:#e78c45">1</span>),})</code></pre></div><div class="paragraph">After receiving same request API will return valid error</div><div class="paragraph"><em>Here&apos;s when i use curl second time.</em></div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code>curl -v \       http://localhost:5000/api/v1/carts/cart/ \  -H <span style="color:#b9ca4a">&apos;Content-Type: application/json&apos;</span> \  -d <span style="color:#b9ca4a">&apos;{  &quot;products&quot;: [  ]}&apos;</span>*   Trying 127.0.0.1...* TCP_NODELAY <span style="color:#e78c45">set</span>* Connected to localhost (127.0.0.1) port 5000 (<span style="color:#969896">#0)</span>&gt; POST /api/v1/carts/cart/ HTTP/1.1&gt; Host: localhost:5000&gt; User-Agent: curl/7.58.0&gt; Accept: */*&gt; Content-Type: application/json&gt; Content-Length: 23&gt; * upload completely sent off: 23 out of 23 bytes* HTTP 1.0, assume close after body&lt; HTTP/1.0 400 BAD REQUEST&lt; Content-Type: application/json&lt; Content-Length: 114&lt; Server: Werkzeug/0.16.0 Python/3.6.8&lt; Date: Mon, 30 Sep 2019 11:13:59 GMT&lt; {    <span style="color:#b9ca4a">&quot;errors&quot;</span>: {        <span style="color:#b9ca4a">&quot;products&quot;</span>: <span style="color:#b9ca4a">&quot;[] is too short&quot;</span>    },    <span style="color:#b9ca4a">&quot;message&quot;</span>: <span style="color:#b9ca4a">&quot;Input payload validation failed&quot;</span>}* Closing connection 0</code></pre></div><div class="paragraph">So, is used curl twice - to find issue and to verify fix. However for now not everything is fixed, i can force <pre><code>ZeroDivisionError</code></pre> if sum of <pre><code>quantity</code></pre> for all products will be 0, for example:  </div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code>{    <span style="color:#b9ca4a">&quot;products&quot;</span>: [        {            <span style="color:#b9ca4a">&quot;product&quot;</span>: <span style="color:#b9ca4a">&quot;milk&quot;</span>,            <span style="color:#b9ca4a">&quot;price&quot;</span>: <span style="color:#e78c45">10</span>,            <span style="color:#b9ca4a">&quot;quantity&quot;</span>: <span style="color:#e78c45">0</span>        }    ]}</code></pre></div><div class="paragraph">So i need to fix this issue and check again, which means i will use curl 2 times more. That doesn&apos;t look like a big deal, but imagine having a long workflow, when issue checking setup will take up to 5-10-15 minutes. </div><div class="paragraph">That means sometimes you gonna stuck for hours doing the same things over and over again.</div><div class="paragraph">Instead of that you can write test. Just get a corrupted data and put it into test function. Add the following code to the <pre><code>test_cart.py</code></pre></div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code><span style="color:#969896">#test_cart.py</span><span class="hljs-function"><span style="color:#c397d8">def</span> <span style="color:#7aa6da">test_empty_cart</span><span style="color:#e78c45">(client)</span>:</span>    data = {        <span style="color:#b9ca4a">&apos;products&apos;</span>: []    }    res = client.post(<span style="color:#b9ca4a">&apos;/api/v1/carts/cart/&apos;</span>, json=data)    <span style="color:#c397d8">assert</span> res.status_code == <span style="color:#e78c45">400</span></code></pre></div><div class="paragraph">Now you can call this in one command <pre><code>pytest -s test_cart.py::test_empty_cart</code></pre> instead of configuring a requests in postman, curl or going over complex flow via your project web interface. </div><div class="paragraph">But this is not the only advantage you can use. Let&apos;s create a dummy test without any assertions to debug api with data, that will cause <pre><code>ZeroDivisionError</code></pre> and add to <pre><code>calculate</code></pre> function an <pre><code>ipdb.set_trace()</code></pre> statement.</div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code><span style="color:#969896">#app.py</span><span class="hljs-function"><span style="color:#c397d8">def</span> <span style="color:#7aa6da">calculate</span><span style="color:#e78c45">(products)</span>:</span>    <span style="color:#c397d8">import</span> ipdb; ipdb.set_trace()    result = {        <span style="color:#b9ca4a">&apos;products&apos;</span>: list(products),    }    <span style="color:#c397d8">for</span> product <span style="color:#c397d8">in</span> result[<span style="color:#b9ca4a">&apos;products&apos;</span>]:        product[<span style="color:#b9ca4a">&apos;total&apos;</span>] = product[<span style="color:#b9ca4a">&apos;quantity&apos;</span>] * product[<span style="color:#b9ca4a">&apos;price&apos;</span>]    result[<span style="color:#b9ca4a">&apos;total&apos;</span>] = sum(product[<span style="color:#b9ca4a">&apos;total&apos;</span>] <span style="color:#c397d8">for</span> product <span style="color:#c397d8">in</span> products)    result[<span style="color:#b9ca4a">&apos;average&apos;</span>] = result[<span style="color:#b9ca4a">&apos;total&apos;</span>] / sum(product[<span style="color:#b9ca4a">&apos;quantity&apos;</span>] <span style="color:#c397d8">for</span> product <span style="color:#c397d8">in</span> products)    <span style="color:#c397d8">return</span> result</code></pre></div><div class="paragraph">Now you can run <pre><code>pytest -s test_cart.py::test_zero_quantiy_cart</code></pre>. Thanks to  <pre><code>ipdb.set_trace()</code></pre> statement, code execution stopped at the beginning of  the <pre><code>calculation</code></pre> function, now you have access to the debugger </div><div class="paragraph"><strong>Important note about pytest and debugging:</strong> don&apos;t forget <pre><code>-s</code></pre> flag to prevent pytest from capturing stdin and stdout. </div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code>pytest -s test_cart.py::test_zero_quantiy_cart========================================================================================================= test session starts =========================================================================================================platform linux -- Python <span style="color:#e78c45">3.6</span><span style="color:#e78c45">.8</span>, pytest<span style="color:#e78c45">-4.4</span><span style="color:#e78c45">.1</span>, py<span style="color:#e78c45">-1.8</span><span style="color:#e78c45">.0</span>, pluggy<span style="color:#e78c45">-0.13</span><span style="color:#e78c45">.0</span>rootdir: /appcollected <span style="color:#e78c45">1</span> item                                                                                                                                                                                                                      test_cart.py &gt; /app/app.py(<span style="color:#e78c45">14</span>)calculate()     <span style="color:#e78c45">13</span>     result = {---&gt; <span style="color:#e78c45">14</span>         <span style="color:#b9ca4a">&apos;products&apos;</span>: list(products),     <span style="color:#e78c45">15</span>     }ipdb&gt; products                                                                                                                                                                                                                         [{<span style="color:#b9ca4a">&apos;price&apos;</span>: <span style="color:#e78c45">10</span>, <span style="color:#b9ca4a">&apos;product&apos;</span>: <span style="color:#b9ca4a">&apos;milk&apos;</span>, <span style="color:#b9ca4a">&apos;quantity&apos;</span>: <span style="color:#e78c45">0</span>}]</code></pre></div><div class="paragraph">Now you can play around with debugger, and if you need to run this code again, you just run tests again. After issue is fixed, you can add some assertions to the test and leave it in your code, since it covers some case that has not yet been covered, otherwise the problem would not have appeared. In this case to fix the bug it&apos;s enough to add <pre><code>min=1</code></pre> to <pre><code>quantity</code></pre> field in <pre><code>Product</code></pre> model</div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code><span style="color:#969896">#app.py</span>Product = api.model(<span style="color:#b9ca4a">&apos;Product&apos;</span>, {    <span style="color:#b9ca4a">&apos;product&apos;</span>: fields.String(required=<span style="color:#c397d8">True</span>),    <span style="color:#b9ca4a">&apos;price&apos;</span>: fields.Float(required=<span style="color:#c397d8">True</span>),    <span style="color:#b9ca4a">&apos;quantity&apos;</span>: fields.Integer(required=<span style="color:#c397d8">True</span>, min=<span style="color:#e78c45">1</span>),})</code></pre></div><div class="paragraph"></div><div class="code-container"><pre style="display:block;overflow-x:auto;background:black;color:#eaeaea;padding:30px"><code><span style="color:#969896">#test_cart.py</span><span class="hljs-function"><span style="color:#c397d8">def</span> <span style="color:#7aa6da">test_zero_quantiy_cart</span><span style="color:#e78c45">(client)</span>:</span>    data = {        <span style="color:#b9ca4a">&apos;products&apos;</span>: [            {                <span style="color:#b9ca4a">&apos;product&apos;</span>: <span style="color:#b9ca4a">&apos;milk&apos;</span>,                <span style="color:#b9ca4a">&apos;price&apos;</span>: <span style="color:#e78c45">10</span>,                <span style="color:#b9ca4a">&apos;quantity&apos;</span>: <span style="color:#e78c45">0</span>            }        ]    }    res = client.post(<span style="color:#b9ca4a">&apos;/api/v1/carts/cart/&apos;</span>, json=data)    <span style="color:#c397d8">assert</span> res.status_code == <span style="color:#e78c45">400</span></code></pre></div><div class="paragraph">The same you can do not only with ipdb, but with any debugger, for example, in PyCharm you can run tests in debug mode. </div><div class="paragraph">Everything, that can by executed, can be also debugged.</div><div class="paragraph">This approach also has following advantages :</div><ul><li> it always gives the same results</li><li> you always have access to tests, written in the past</li><li> you don&apos;t need any other software, like postman, to test your code</li><li> you have access to mocks, provided by your testing framework</li><li> you&apos;ll have your specific case covered with tests, when you finish your work</li></ul><div class="paragraph"><strong>WHEN THIS CAN BE USEFUL</strong></div><div class="paragraph">Here are some real scenarios when I found this approach useful.</div><ol><li> While developing some new functions i tend to create some basic code to  proof the concept, then write some tests and continue development with their help. That can save a lot of time. Sometimes i don`t open anything except my IDE for a week.</li><li> While having a bug you can put a breakpoint somewhere in a suspicious place, look into local context and create a test with data you found in debugger. It can also save a lot of time.</li><li> While developing integration with third party API you can use tests to simplify and automate authorization, preparing data and so on. Also, after integration is done, you can use mocking, so your tests won`t send any real requests.</li><li> I tend to use REPL(e.g. IPyhton) a lot while playing around with new libraries or functionality. If i need to perform some actions many times - it&apos;s a good idea to wrap them into a test.</li><div class="Divider"><i></i><i></i><i></i><i></i><i></i><i></i></div><div class="paragraph">In conclusion, i would like to say, that this little technique not only can save  a lot of time, but also can help you concentrate on your code and avoid frustration due to the constant repetition of the same actions. Coding feels much more enjoyable, when you actually do coding.</div></ol><div class="paragraph"></div><div class="paragraph"></div>                    <h2 class="tags-header">Tags</h2>          <div class="archive-tags">                                                <a class="tag" href="https://hackernoon.com/tagged/python-tips">Python Tips</a>                                                <a class="tag" href="https://hackernoon.com/tagged/python">Python</a>                                                <a class="tag" href="https://hackernoon.com/tagged/unit-testing">Unit Testing</a>                                                <a class="tag" href="https://hackernoon.com/tagged/software-engineering">Software Engineering</a>                                                <a class="tag" href="https://hackernoon.com/tagged/coding">Coding</a>                                                <a class="tag" href="https://hackernoon.com/tagged/progrramming">Progrramming</a>                                                <a class="tag" href="https://hackernoon.com/tagged/latest-tech-stories">Latest Tech Stories</a>                                                <a class="tag" href="https://hackernoon.com/tagged/software-development">Software Development</a>                      </div>                                        <div class="twitter-discussion">            <a target="_blank" href="https://community.hackernoon.com/t/16864">Continue the Discussion <i class="fas fa-comments-alt"></i></a>          </div>