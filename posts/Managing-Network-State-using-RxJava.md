<figure><img alt src="https://hackernoon.com/hn-images/1*boVgTFOTM9vGgcCfufNmRQ.png"></figure><p>We often use RxJava for fetching network result, but usually have it tell us either Success or Error. How nice if it could also tell us Loading and perhaps Empty (nothing loaded) state as well, so we don&#x2019;t need to handle that logic separately, and have it communicate to the View the State&#xA0;result.</p><h3>Get started</h3><p>I believe the RxJava code below is no longer stranger to anyone who has coded a network&#xA0;call.</p><pre><code class="language-markup">service.fetchResult()        .subscribeOn(Schedulers.io())        .observeOn(AndroidSchedulers.mainThread())        .subscribe(                { data -&gt; process(data) },                { error -&gt; report_error(error) }<strong>        </strong>)</code></pre><p>It&#x2019;s supercool, as it helps one to put the network request to the background easily, and handle the result or result&#xA0;easily.</p><h3>Get greedier</h3><p>A lot of times, we want something more than just Data or Error. While waiting for the fetching, we want to show Loading State on the UI. If the result comes back as empty result, we want to show Empty&#xA0;State.</p><p>In order to achieve that, we write more code surrounding the above Rx fetching code (within our presenter perhaps) to handle and update the UI accordingly.</p><p>How nice if we could do that all in RxJava, as per illustrate in the diagram&#xA0;below.</p><figure><img alt src="https://hackernoon.com/hn-images/1*YdUbwGlrDNGhfkgahl7ogg.png"></figure><h3>Get smarter</h3><p>Thinking about it, we could possibly do that. Instead of handling all the logic in our presenter, we have use a model that represent all the&#xA0;state.</p><p>Here I defined it as&#xA0;below</p><pre><code class="language-markup">data class <strong>UiStateModel</strong> (        private val inProgress: Boolean = false,        private val errorMessage: String? = null,        private val dataModel: DataModel? = null) {</code></pre><pre><code class="language-markup">    fun isLoading() = inProgress    fun isError() = errorMessage != null    fun isSuccess() =          dataModel?.dataString?.<em>isNotEmpty</em>() ?: false &amp;&amp; !isError()    fun isEmpty() =          !inProgress &amp;&amp; errorMessage == null &amp;&amp; !isSuccess()}</code></pre><p>We could setup the Model that store inProgress flag, errorMessage and data. Based on these info, the model could be used to check if it is in Loading, Error, Success or Empty&#xA0;state.</p><p>To make this better, we could make the having some static class that instantiate UiStateModel per the&#xA0;state.</p><pre><code class="language-markup">companion object {    fun loading() = UiStateModel(inProgress = true)    fun success(dataModel: DataModel)         = UiStateModel(dataModel = dataModel)    fun error(error: Throwable)         = UiStateModel(errorMessage = error.message)}</code></pre><h3>Get linked</h3><p>So with this model now we have could represent the state, how we could combined to make use of it? Check out the code below that is used in the presenter.</p><pre><code class="language-markup">service.fetchResult()        .map <strong>{ </strong>data <strong>-&gt; </strong>UiStateModel.success(data) <strong>}        .onErrorReturn </strong>             { exception -&gt; UiStateModel.error(exception) }<strong>        .startWith</strong>(UiStateModel.loading())        .subscribeOn(Schedulers.io())        .observeOn(AndroidSchedulers.mainThread())        .subscribe(<strong>{            </strong>uiState <strong>-&gt;            </strong>when {                uiState.isLoading() -&gt; view.isLoading()                uiState.isError() -&gt;                        view.isError(uiState.getErrorMessage())                uiState.isSuccess() -&gt;                        view.isSuccess(uiState.getData())                uiState.isEmpty() -&gt; view.isEmpty()                else -&gt; IllegalArgumentException(&quot;Invalid Response&quot;)            }        <strong>}</strong>)</code></pre><p>After fetching the result from the server, if it is successful, we convert it into a success UiStateModel. If it is error, we use onErrorReturn to convert it into an error UiStateModel.</p><p>The nice bit here is, on start, we could use startWith to convert it to loading UiStateModel.</p><p>We now have all the states specified, including empty State, which is handled internally within the UiStateModel to define it&#x2019;s&#xA0;state.</p><figure><img alt src="https://hackernoon.com/hn-images/1*5NCQVnEQPTVpvJlM5-yBQg.png"></figure><h3>Get code</h3><p>I&#x2019;ve made code example showing the flow in <a href="https://github.com/elye/demo_rxjava_manage_state">https://github.com/elye/demo_rxjava_manage_state</a></p><p>It shows all the states scenarios as below. Have&#xA0;fun!</p><figure><img alt src="https://hackernoon.com/hn-images/1*ws1meR7GRbgMqtlrXrQ6zg.gif"></figure><p>The example here is a very simplified example as per shared by Jake Wharton. Check it out further for more insights.</p><p><a href="http://jakewharton.com/the-state-of-managing-state-with-rxjava/">Presentation: The State of Managing State with RxJava</a></p><p>Click &#x201C;&#x2764;&#x201D; below to share. Thanks! ~<a href="https://twitter.com/elye_project"><em>Twitter:elye</em></a><em>; </em><a href="https://www.facebook.com/elyeproj/"><em>Facebook:elye</em></a></p>                <div class="archive-tags">                                        <a class="tag" href="https://hackernoon.com/tagged/software-development">Software Development</a>                                        <a class="tag" href="https://hackernoon.com/tagged/mobile-app-development">Mobile App Development</a>                                        <a class="tag" href="https://hackernoon.com/tagged/android-app-development">Android App Development</a>                                        <a class="tag" href="https://hackernoon.com/tagged/coding">Coding</a>                                        <a class="tag" href="https://hackernoon.com/tagged/android">Android</a>                  </div>                <div class="twitter-discussion">          <a target="_blank" href="https://twitter.com/search?q=https%3A%2F%2Fhackernoon.com%2Fmanaging-network-state-using-rxjava-79cdaed88d5d">Continue the discussion <i class="fab fa-twitter"></i></a>        </div>