<h3><strong>How to avoid a Deadlock while writing Concurrent Programs</strong>&#x200A;&#x2014;&#x200A;Java&#xA0;Example</h3><figure><a href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=323058.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fmultithreading-and-parallel-computing-in-java%2F"><img alt src="https://hackernoon.com/hn-images/1*mdFN-uFWVcwP9Ur9P5NV_w.png"></a><figcaption><a href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=323058.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fmultithreading-and-parallel-computing-in-java%2F">Multithreading and Parallel Computing in&#xA0;Java</a></figcaption></figure><p>Hello guys, do you want to learn how to avoid deadlock while writing concurrent programs, especially in Java? Writing correct concurrent application is never easy as you have to deal with several concurrency issues like <a href="http://javarevisited.blogspot.sg/2012/02/what-is-race-condition-in.html#axzz59AbkWuk9">race conditions</a>, livelock, <a href="https://javarevisited.blogspot.com/2018/08/how-to-avoid-deadlock-in-java-threads.html">deadlock</a>, memory interference etc.</p><p>In this article, I&apos;ll tell you how to avoid deadlock while writing a concurrent program as an interview question discussion. Since I am Java developer, I&#x2019;ll explain the concept and implementation in Java but <strong>the technique I&#x2019;ll share with you is valid for all kind of programming languages</strong> like C++ or C#&#xA0;etc.</p><p>The question of avoiding deadlock is one of the popular <a href="http://javarevisited.blogspot.sg/2015/10/133-java-interview-questions-answers-from-last-5-years.html">Java interview question</a>s, with multi-threading being asked mostly at a senior level interview with lots of follow up questions.</p><p>Even though the question looks very basic, most of the Java developers get stuck once you start going&#xA0;deeper.</p><p>So, <strong>what is a deadlock?</strong> The answer is simple&#x200A;&#x2014;&#x200A;when two or more threads are waiting for each other to release the resource they need (lock) and get stuck for infinite time, the situation is called deadlock.</p><p>It will only happen in the case of <a href="http://www.java67.com/2015/11/difference-between-multithreading-and-multitasking.html">multitasking</a> or <a href="https://javarevisited.blogspot.com/2018/06/top-5-java-multithreading-and-concurrency-courses-experienced-programmers.html">multi-threading</a>, because that&#x2019;s where multiple threads come into the&#xA0;picture.</p><h3>1. How Do you detect Deadlock in&#xA0;Java?</h3><p>Though this could have many answers, first, I would look at the code to see if a nested <a href="http://www.java67.com/2013/01/difference-between-synchronized-block-vs-method-java-example.html">synchronized block</a> is calling a <a href="http://javarevisited.blogspot.sg/2011/05/wait-notify-and-notifyall-in-java.html">synchronized method</a> from another or if it is trying to get a lock on a different object.</p><p>If that is the case, there is a good chance of deadlock, if the developer is not&#xA0;careful.</p><p>Another way to determine deadlock risks is when you actually get dead-locked while running the application.</p><p>If this happens, try to take a <strong>thread dump</strong>, in Linux you can do this by the command <strong>&#x201C;kill -3.&#x201D;</strong> This will print the status of all threads in an application log file, and you can see which thread is locked on which&#xA0;object.</p><p>You can analyze that thread dump with using tools like <a href="http://fastthread.io/">fastthread.io</a>, which allows you to upload your thread dump and analyze&#xA0;it.</p><p>Another way is to use the <strong>jConsole/VisualVM</strong>. It will show you exactly which threads are getting locked and on which&#xA0;object.</p><p>If you are interested in learning about troubleshooting tools and the process to analyzing your thread dump, I suggest you take a look at this <a href="https://pluralsight.pxf.io/c/1193463/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fcourses%2Fanalyzing-java-thread-dumps"><strong>Analyzing Java Thread Dump</strong>s</a> course on Pluralsight by Uriah&#xA0;Levy.</p><p>This is an advanced practice course to learn more about Java thread dump and familiarize you with other popular advanced troubleshooting tools.</p><figure><a href="https://pluralsight.pxf.io/c/1193463/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fcourses%2Fanalyzing-java-thread-dumps"><img alt src="https://hackernoon.com/hn-images/1*hrNJvzubP2xaQjxPPtVKpQ.png"></a><figcaption><a href="https://pluralsight.pxf.io/c/1193463/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fcourses%2Fanalyzing-java-thread-dumps"><strong>Analyzing Java Thread&#xA0;Dump</strong>s</a></figcaption></figure><p>Btw, you would need a Pluralsight membership to get access this course, which cost around $29 per month or <a href="https://pluralsight.pxf.io/c/1193463/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fpricing">$299 annually</a> (14% discount).</p><p>If you don&#x2019;t have <a href="http://pluralsight.pxf.io/c/1193463/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Flearn">Pluralsight membership</a>, I encourage you to get one because it allows you to access their 5000+ online courses on all latest topics like front-end and back-end development, machine learning&#xA0;etc.</p><p>It also include interactive quizzes, exercises, and latest certification material&#xA0;. <br>It&#x2019;s more like Netflix for Software Developers and Since learning is an important part of our job, Plurlasight membership is a great way to stay ahead of your competition.</p><p>They also provide a <a href="http://pluralsight.pxf.io/c/1193463/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Flearn"><strong>10-day free trial</strong></a> without any commitment, which is a great way to not just access this course for free but also to check the quality of courses before joining Pluralsight.</p><h3>2. Write a Java Program That Will Result in&#xA0;Deadlock</h3><p>Once you answer the earlier question, they may ask you how to write code that will result in a deadlock in&#xA0;Java.</p><p>Here is one way of doing&#xA0;it:</p><figure><a href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=323058.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fmultithreading-and-parallel-computing-in-java%2F"><img alt src="https://hackernoon.com/hn-images/1*K4mGU275LPD5I9etr-YDdg.png"></a><figcaption><a href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=323058.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fmultithreading-and-parallel-computing-in-java%2F">Multithreading and Parallel Computing in&#xA0;Java</a></figcaption></figure><p>If method1() and method2() are both called by two or more threads, there is a good chance of <a href="http://www.java67.com/2012/08/5-thread-interview-questions-answers-in.html">deadlock</a>, because if Thread 1 acquires a lock on a String object while executing method1() and Thread 2 acquires a lock on the Integer object while executing method2()&#xA0;, <strong>both will be waiting for each other to release a lock</strong> on the Integer and String to proceed further, which will never&#xA0;work.</p><p>This diagram effectively demonstrates our program, where <em>one thread holds a lock on one object and is waiting for the other object to lock, which is held by the other&#xA0;thread.</em></p><figure><a href="https://pluralsight.pxf.io/c/1193463/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fcourses%2Fjava-patterns-concurrency-multi-threading"><img alt src="https://hackernoon.com/hn-images/0*4_Q3TgYKslsSoELI.jpg"></a><figcaption><a href="https://pluralsight.pxf.io/c/1193463/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fcourses%2Fjava-patterns-concurrency-multi-threading">Applying Concurrency and Multi-threading to Common Java&#xA0;Patterns</a></figcaption></figure><p>You can see that Thread 1 wants the lock on Object 2, which is held by Thread 2, and Thread 2 wants a lock on Object 1, which is held by Thread&#xA0;1.</p><p>Since no thread is willing to give up, there is a deadlock and the Java program is stuck. This condition is also known as &#x201C;Circular Wait with No Preemption&#x201D;.</p><p>The idea is that you should know the right way to use common concurrent patterns, and if you are not familiar with them then <a href="https://pluralsight.pxf.io/c/1193463/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fcourses%2Fjava-patterns-concurrency-multi-threading"><strong>Applying Concurrency and Multi-threading to Common Java Patterns</strong></a> by Jose Paumard is a good starting point to&#xA0;learn.</p><h3>3. How to Avoid Deadlock in&#xA0;Java</h3><p>Now, the interviewer comes to the final part and one of the most important questions, in my opinion: <em>How do you fix a deadlock in&#xA0;code?</em></p><p>If you have looked at the above code carefully, then you may have figured out that the real reason for deadlock is not multiple threads, but it is the way that they are requesting a&#xA0;lock.</p><blockquote><em>If you provide an </em><strong><em>ordered access</em></strong><em>, then the problem will be resolved.</em></blockquote><p>Here is my fixed version, which avoids deadlock by using a<strong> circular wait with no preemption</strong>. This is one of the four conditions needed for&#xA0;deadlock</p><figure><a href="https://learning.javaspecialists.eu/courses/concurrency-in-practice-bundle?affcode=92815_johrd7r8"><img alt src="https://hackernoon.com/hn-images/1*aB2a3SjF-h-OECyAAVKfgQ.png"></a><figcaption><a href="https://learning.javaspecialists.eu/courses/concurrency-in-practice-bundle?affcode=92815_johrd7r8">Java Concurrency in Practice Bundle by Heinz&#xA0;Kabutz</a></figcaption></figure><p>Now, there would not be any deadlock, because both methods are accessing a lock on the Integer and String class literal in the same&#xA0;order.</p><p>So, if Thread A acquires a lock on the Integer object, Thread B will not proceed until Thread A releases the Integer&#xA0;lock.</p><p>This is done in the same way Thread A will not be blocked, even if Thread B holds a String lock, because, now, Thread B will not expect Thread A to release an Integer lock to proceed any&#xA0;further.</p><p>That&#x2019;s all about <strong>how to avoid a deadlock while writing concurrent programs</strong>. As I have said that even the discussion and example in Java, the technique I have shared, ordered access to a shared resource is language independent and applicable everywhere.</p><p>Formally this is known as breaking the Circular Wait with No Preemption condition required for deadlock but I just call it ordered access of the shared resource.</p><p>If you want to learn more about Concurrency, Multithreading and Concurrent programming in general, here are some useful resources.:</p><h4>Further Learning</h4><p><a href="https://click.linksynergy.com/fs-bin/click?id=JVFxdTr9V80&amp;subid=0&amp;offerid=323058.1&amp;type=10&amp;tmpid=14538&amp;RD_PARM1=https%3A%2F%2Fwww.udemy.com%2Fmultithreading-and-parallel-computing-in-java%2F">Multithreading and Parallel Computing in Java</a><br><a href="http://www.amazon.com/dp/0321349601/?tag=javamysqlanta-20">Java Concurrency in Practice&#x200A;&#x2014;&#x200A;The Book</a><br><a href="https://pluralsight.pxf.io/c/1193463/424552/7490?u=https%3A%2F%2Fwww.pluralsight.com%2Fcourses%2Fjava-patterns-concurrency-multi-threading">Applying Concurrency and Multi-threading to Common Java Patterns</a><br><a href="https://learning.javaspecialists.eu/courses/concurrency-in-practice-bundle?affcode=92815_johrd7r8">Java Concurrency in Practice Bundle by Heinz Kabutz</a><br><a href="https://javarevisited.blogspot.com/2015/05/top-10-java-multithreading-and.html#axzz5Neevu8QO">10 Java Multithreading and Concurrency Best Practices</a><br><a href="http://javarevisited.blogspot.sg/2014/07/top-50-java-multithreading-interview-questions-answers.html#axzz4jaJmaqbE">Top 50 Multithreading and Concurrency Questions in&#xA0;Java</a></p><h3>Closing Notes</h3><p>Thanks for reading this article so far. You might be thinking that there this is trivial but I tell you that it&#x2019;s an important concept and important for both writing correct concurrent programs as well for doing well on interviews.</p><p>At the end of the day, you should have enough knowledge and experience about the things mentioned here.</p><p>Good luck with your Concurrent Programming journey! It&#x2019;s certainly <strong>not going to be easy</strong>, but by following this roadmap and guide, you are one step closer to becoming the <a href="https://javarevisited.blogspot.com/2018/05/10-tips-to-become-better-java-developer.html">better developer</a>, you always wanted to&#xA0;be</p><p>If you like this article then please consider following me on medium (<a href="https://medium.com/u/bb36d8439904">javinpaul</a>). if you&#x2019;d like to be notified for every new post and don&#x2019;t forget to follow<strong> </strong><a href="https://twitter.com/javarevisited"><strong>javarevisited</strong></a> on&#xA0;Twitter!</p><h4>P.S.&#x200A;&#x2014;&#x200A;If you want to learn Java and Multithreading and looking for some free courses, please check J<a href="http://bit.ly/2hjnumD">ava Multithreading&#x200A;&#x2014;&#x200A;A #FREE course</a> to start&#xA0;with.</h4>                <div class="archive-tags">                                        <a class="tag" href="https://hackernoon.com/tagged/coding">Coding</a>                                        <a class="tag" href="https://hackernoon.com/tagged/java">Java</a>                                        <a class="tag" href="https://hackernoon.com/tagged/javascript-deadlock">Javascript Deadlock</a>                                        <a class="tag" href="https://hackernoon.com/tagged/software-development">Software Development</a>                                        <a class="tag" href="https://hackernoon.com/tagged/programming">Programming</a>                  </div>                <div class="twitter-discussion">          <a target="_blank" href="https://twitter.com/search?q=https%3A%2F%2Fhackernoon.com%2Fhow-to-avoid-a-deadlock-while-writing-concurrent-programs-java-example-988bb07db25f">Continue the discussion <i class="fab fa-twitter"></i></a>        </div>